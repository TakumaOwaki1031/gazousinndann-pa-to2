# gazousinndann-pa-to2
形×色モデルを融合した画像診断エンジン

＜設計思想＞
本プロジェクトは、以下の3つの思想を中心に設計されています。

### 1. 乗算による特徴の組み合わせと精度向上
形モデルと色モデルの出力を乗算することで、
複数の特徴が同時に強く出ている場合に、より高い精度で判定できるようにしています。

一般的な特徴融合では、複数の特徴量を加算で統合することが多いです。
加算は「どれか一つの特徴が強ければスコアが上がる」という性質を持ちます。
しかし本プロジェクトでは、将来的に複数の特徴（形・色以外も含む）を扱うことを想定し、
下記の理由により精度の高い推定を行うために乗算を採用しています。

- 特徴が増えるほど、乗算のメリットが大きくなる
- 特徴間の“同時成立”を重視した推定が可能になる
- どれか一つの特徴が低いと最終スコアも小さくなる
  
特徴が増えたときに最も高い精度を発揮できる構造として、乗算を選択しています。

---

### 2. 指数による「特徴の強さ」の調整
softmax の確率値から得られる特徴量に対して指数（exp）を適用することで、

- **そもそも特徴を抽出できていないものは寄与が小さくなる**
- **弱いが確かに特徴を抽出できているものは寄与が大きくなる**

という性質を実現しています。

指数が小さい特徴は 1 に近づき、  
指数が大きい特徴は強調されます。

---

### 3. データセットの最頻値（mode）を指数にフィードバック
データセット全体の softmaxの確率値の分布から **最頻値（mode）** を取り出し、
その値を底とした対数変換によって指数を自動決定します。

exp = log(x) / log(mode)

- mode が小さい → 特徴が弱い → exp も小さくなる  
- mode が大きい → 特徴が強い → exp が大きくなる  

これにより、  
「特徴が抽出できないものは結果に寄与しない」
「弱い特徴を強く検出できるようにする」
という思想で作成しています。
---------------------------------------------------------------------
＜使い方＞

本プロジェクトは、Python と Java の2段構成で動作します。
まず Python で「形モデル」と「色モデル」の softmax 分布を解析し、指数（exp）を決定します。
その後 Java で推論と特徴融合を行います。

---

### 1. データセットを配置する

dataset/
 target/
      (複数枚の画像)

※ データセットは公開していないため、ユーザー自身で用意してください。

---

### 2. Python を実行してモデルを作成する  
形モデル・色モデルの両方について Python を実行します。

#### ● 形モデル（shape）の指数を計算
python Shape_model.py
#### ● 色モデル（color）の指数を計算
python Color_model.py

これにより以下のファイルが生成されます：

models/

 ├ shape_model.onnx  
 
 └ color_model.onnx  

※ モデルは公開していないため、ユーザー自身で作成してください。

---
### 4. Java の Main を実行する

Java プロジェクトとしてビルドし、Main を実行します。

出力される内容：

- shape モデルの softmax 値  
- color モデルの softmax 値  
- データセットから計算した指数（exp）  
- 最終融合スコア（shape × color × exp）

---

### 5. 出力の意味

- **色/形の指数**  
  → データセットの分布から自動決定される「特徴の強さ」
  大きいほどその特徴は強く出ており、
  小さいほど特徴を抽出できていない。

- **最終融合スコア**  
  → shape × color × exp による最終判定値。
以上です。


